
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Papers</title>
  <link rel="stylesheet" href="/_styles/citation.css">
  <link rel="stylesheet" href="/_styles/tags.css">
  <link rel="stylesheet" href="/_styles/button.css">
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f7f7f7;
    }
    .alps-header {
      background: #455a64;
      color: #fff;
      padding: 0;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .alps-header-bar {
      display: flex;
      align-items: center;
      padding: 0 24px;
      height: 64px;
    }
    .alps-title {
      font-size: 2rem;
      font-weight: bold;
      margin-right: 32px;
    }
    .alps-nav {
      display: flex;
      gap: 8px;
    }
    .alps-nav a {
      color: #fff;
      text-decoration: none;
      font-weight: 500;
      padding: 8px 16px;
      border-radius: 4px;
      transition: background 0.2s;
    }
    .alps-nav a:hover {
      background: #607d8b;
    }
    .paperlist-container {
      max-width: 1200px;
      margin: 0 auto;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      padding: 24px 24px 32px 24px;
      display: flex;
      flex-direction: row;
      gap: 32px;
    }
    .paperlist-main {
      flex: 1 1 0;
      min-width: 0;
    }
    .paperlist-controls {
      display: flex;
      align-items: center;
      gap: 24px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }
    .paperlist-slider {
      flex: 1 1 0;
      min-width: 220px;
      max-width: 350px;
      margin-right: 12px;
    }
    .slider-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.95em;
      color: #888;
      margin-top: 2px;
      margin-bottom: 8px;
    }
    .paperlist-sort {
      min-width: 140px;
      font-size: 1em;
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid #bbb;
      background: #f7f7f7;
      color: #333;
    }
    .paperlist-count {
      font-size: 1.1em;
      color: #444;
      margin-left: 8px;
    }
    .reset-btn {
      background: #e53935;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 7px 18px;
      font-size: 1em;
      font-weight: 500;
      cursor: pointer;
      margin-left: 12px;
      transition: background 0.2s;
    }
    .reset-btn:hover {
      background: #b71c1c;
    }
    .paperlist-list {
      margin-top: 12px;
    }
    .paperlist-item {
      display: flex;
      align-items: flex-start;
      gap: 18px;
      padding: 18px 0 10px 0;
      border-bottom: 1px solid #eee;
    }
    .paperlist-item:last-child {
      border-bottom: none;
    }
    .paper-title {
      font-weight: bold;
      font-size: 1.08em;
      margin-bottom: 2px;
      color: #222;
      text-decoration: none;
    }
    .paper-title:hover {
      text-decoration: underline;
    }
    .paper-authors {
      color: #888;
      font-size: 0.98em;
      margin-bottom: 2px;
    }
    .paper-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 7px;
      margin-top: 2px;
    }
    .chip {
      display: inline-block;
      padding: 3px 12px;
      border-radius: 999px;
      font-size: 0.97em;
      font-weight: 500;
      background: #eee;
      color: #444;
      cursor: pointer;
      user-select: none;
      border: none;
      transition: background 0.2s, color 0.2s;
    }
    .chip.type {
      background: #43a047;
      color: #fff;
    }
    .chip.prior {
      background: #fff;
      color: #666;
      border: 1.5px solid #bbb;
    }
    .chip.selected {
      background: #1976d2;
      color: #fff;
    }
    .chip.pub {
      background: #ffb300;
      color: #fff;
      font-weight: 600;
      border: 1.5px solid #ffb300;
    }
    .chip.pub[variant="outlined"] {
      background: #fff3e0;
      color: #ff9800;
      border: 1.5px solid #ffb300;
    }
    .sidebar {
      min-width: 220px;
      max-width: 260px;
      padding-left: 12px;
      border-left: 1.5px solid #e0e0e0;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .sidebar-label {
      font-size: 1.08em;
      font-weight: 500;
      margin-bottom: 6px;
      color: #333;
    }
    .sidebar-chips {
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex-wrap: wrap;
    }
    @media (max-width: 900px) {
      .paperlist-container {
        flex-direction: column;
        gap: 0;
        padding: 10px 2vw 24px 2vw;
      }
      .sidebar {
        border-left: none;
        border-top: 1.5px solid #e0e0e0;
        margin-top: 24px;
        padding-left: 0;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 12px;
      }
      .sidebar-chips {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="alps-header">
    <div class="alps-header-bar">
      <a class="alps-title" href="http://expopt.org" style="color:inherit;text-decoration:none;">Home</a>
    </div>
  </div>
  <div class="paperlist-container">
    <div class="paperlist-main">
      <div class="paperlist-controls">
        <div class="paperlist-slider">
          <input type="range" id="year-range-min" min="0" max="0" value="0" step="1" style="width:49%">
          <input type="range" id="year-range-max" min="0" max="0" value="0" step="1" style="width:49%;float:right;">
          <div class="slider-labels" id="year-slider-labels"></div>
        </div>
        <select id="sort-filter" class="paperlist-sort">
          <option value="desc">Newest first</option>
          <option value="asc">Oldest first</option>
        </select>
        <span class="paperlist-count" id="paper-count"></span>
        <button class="reset-btn" id="reset-filters" style="display:none;">Reset</button>
      </div>
      <div class="paperlist-list" id="papers-list"></div>
    </div>
    <div class="sidebar">
      <div class="sidebar-label">Filter by label</div>
      <div class="sidebar-chips" id="chip-filters"></div>
    </div>
  </div>
  <script>
    // --- PaperList logic ---
    const TYPE_LABELS = [
      "dynamic / data structure",
      "online",
      "running time",
      "approximation",
      "streaming",
      "game theory / mechanism design",
      "differential privacy",
      "survey"
    ];
    const PRIOR_LABEL = "prior/related work";
    let papers = [];
    let selectedLabels = [];
  let yearMin = 0, yearMax = 0, yearRange = [0,0], allYears = [];
    let allLabels = [];
    // Fetch and preprocess papers
    fetch('/_data/papers.json')
      .then(r => r.json())
      .then(data => {
        papers = data.filter(p => typeof p === 'object' && p.title);
        allYears = Array.from(new Set(papers.flatMap(p => {
          let years = [];
          if (Array.isArray(p.publications)) {
            years = p.publications.map(pub => pub.year).filter(y => y != null);
          } else if (p.year) {
            years = [p.year];
          }
          return years;
        }))).sort((a,b)=>a-b);
        yearMin = allYears[0] || 2000;
        yearMax = allYears[allYears.length-1] || 2025;
        yearRange = [yearMin, yearMax];
        allLabels = Array.from(new Set(papers.flatMap(p => Array.isArray(p.labels) ? p.labels : [])));
        renderYearSlider();
        renderFilters();
        renderPapers();
      });

    function renderYearSlider() {
      const minSlider = document.getElementById('year-range-min');
      const maxSlider = document.getElementById('year-range-max');
      minSlider.min = 0;
      minSlider.max = allYears.length-1;
      minSlider.value = 0;
      maxSlider.min = 0;
      maxSlider.max = allYears.length-1;
      maxSlider.value = allYears.length-1;
      minSlider.oninput = function() {
        if (parseInt(minSlider.value) > parseInt(maxSlider.value)) {
          minSlider.value = maxSlider.value;
        }
        yearRange = [allYears[minSlider.value], allYears[maxSlider.value]];
        renderYearLabels();
        renderPapers();
      };
      maxSlider.oninput = function() {
        if (parseInt(maxSlider.value) < parseInt(minSlider.value)) {
          maxSlider.value = minSlider.value;
        }
        yearRange = [allYears[minSlider.value], allYears[maxSlider.value]];
        renderYearLabels();
        renderPapers();
      };
      yearRange = [allYears[0], allYears[allYears.length-1]];
      renderYearLabels();
    }
    function renderYearLabels() {
      const labels = allYears.map((y, i) => {
        if (i === 0 || i === allYears.length-1 || i % 2 === 0) {
          return "'"+String(y).slice(-2);
        } else {
          return '';
        }
      });
      document.getElementById('year-slider-labels').innerHTML = labels.join(' ');
    }
    function renderFilters() {
      let chipFilters = document.getElementById('chip-filters');
      chipFilters.innerHTML = '';
      // Show type labels first, then prior, then others
      TYPE_LABELS.concat([PRIOR_LABEL]).forEach(label => { chipFilters.appendChild(labelChip(label)); });
      allLabels.filter(l => !TYPE_LABELS.includes(l) && l !== PRIOR_LABEL).sort().forEach(label => { chipFilters.appendChild(labelChip(label)); });
    }
    function labelChip(label) {
      const span = document.createElement('span');
      span.className = 'chip';
      if (TYPE_LABELS.includes(label)) span.classList.add('type');
      if (label === PRIOR_LABEL) span.classList.add('prior');
      if (selectedLabels.includes(label)) span.classList.add('selected');
      span.textContent = label;
      span.onclick = () => {
        if (selectedLabels.includes(label)) {
          selectedLabels = selectedLabels.filter(l => l !== label);
        } else {
          selectedLabels = [label, ...selectedLabels];
        }
        renderFilters();
        renderPapers();
      };
      return span;
    }
    document.getElementById('reset-filters').onclick = function() {
      selectedLabels = [];
      document.getElementById('year-range').value = allYears.length-1;
      yearRange = [yearMin, yearMax];
      document.getElementById('sort-filter').value = 'desc';
      renderFilters();
      renderPapers();
    };
    document.getElementById('sort-filter').onchange = function() {
      renderPapers();
    };
    function renderPapers() {
      const sort = document.getElementById('sort-filter').value;
      const minIdx = parseInt(document.getElementById('year-range-min').value);
      const maxIdx = parseInt(document.getElementById('year-range-max').value);
      const yearFrom = allYears[minIdx] || yearMin;
      const yearTo = allYears[maxIdx] || yearMax;
      let filtered = papers.filter(p => {
        // Find all years for this paper (from publications)
        let paperYears = [];
        if (Array.isArray(p.publications)) {
          paperYears = p.publications.map(pub => pub.year).filter(y => y != null);
        } else if (p.year) {
          paperYears = [p.year];
        }
        // Paper is included if any of its years is in the selected range
        let inRange = paperYears.some(y => y >= yearFrom && y <= yearTo);
        if (!inRange) return false;
        if (selectedLabels.length > 0) {
          if (!Array.isArray(p.labels) || !selectedLabels.every(t => p.labels.includes(t))) return false;
        }
        return true;
      });
      filtered.sort((a, b) => {
        // Sort by the newest (or oldest) publication year
        let aYear = Math.max(...(Array.isArray(a.publications) ? a.publications.map(pub => pub.year || 0) : [a.year || 0]));
        let bYear = Math.max(...(Array.isArray(b.publications) ? b.publications.map(pub => pub.year || 0) : [b.year || 0]));
        if (sort === 'desc') return bYear - aYear;
        else return aYear - bYear;
      });
      document.getElementById('paper-count').textContent = `${filtered.length} papers`;
      const container = document.getElementById('papers-list');
      container.innerHTML = '';
      filtered.forEach(paper => {
        const div = document.createElement('div');
        div.className = 'paperlist-item';
        // Publication chips (arXiv, CPM, etc.)
        let pubChips = '';
        if (Array.isArray(paper.publications)) {
          pubChips = paper.publications.map(pub => {
            let name = pub.displayName || pub.name || '';
            let text = name + (pub.year ? ` '${String(pub.year).slice(-2)}` : '');
            let variant = (name === 'arXiv') ? 'outlined' : 'filled';
            return `<span class='chip pub' variant='${variant}' onclick='window.open(\"${pub.url||'#'}\",\"_blank\")'>${text}</span>`;
          }).join(' ');
        }
        // Label chips
        let labelChips = '';
        if (Array.isArray(paper.labels)) {
          labelChips = paper.labels.map(l => {
            let cls = 'chip';
            if (TYPE_LABELS.includes(l)) cls += ' type';
            if (l === PRIOR_LABEL) cls += ' prior';
            return `<span class='${cls}'>${l}</span>`;
          }).join(' ');
        }
        div.innerHTML = `
          <div style=\"flex:1;min-width:0;\">
            <div class=\"paper-title\">${paper.url ? `<a href='${paper.url}' target='_blank'>${paper.title}</a>` : paper.title}</div>
            <div class=\"paper-authors\">${paper.authors || ''}</div>
            <div class=\"paper-chips\">${pubChips} ${labelChips}</div>
          </div>
        `;
        container.appendChild(div);
      });
      // Show reset if any filter is active
      const minDefault = 0, maxDefault = allYears.length-1;
      document.getElementById('reset-filters').style.display = (selectedLabels.length || minIdx !== minDefault || maxIdx !== maxDefault) ? '' : 'none';
    }
  </script>
</body>
</html>